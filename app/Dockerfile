# ----------------------------------------------------------------------------
# File: app/Dockerfile
# Author: Vilhelm Hilding
# Project: Arxite â€“ Hardened Web Application Architecture
# Description: Dockerfile for building and running the Flask application container.
# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------
# Base image: official slim Python runtime
# ----------------------------------------------------------------------------
FROM python:3.11-slim

# ----------------------------------------------------------------------------
# Set the working directory inside the container
# ----------------------------------------------------------------------------
WORKDIR /app

# ----------------------------------------------------------------------------
# Install Python dependencies
# ----------------------------------------------------------------------------
COPY app/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ----------------------------------------------------------------------------
# Copy application source code
# ----------------------------------------------------------------------------
COPY . .

# ----------------------------------------------------------------------------
# Security: run as non-root user
# ----------------------------------------------------------------------------
RUN adduser --disabled-password --gecos '' flaskuser
USER flaskuser

# ----------------------------------------------------------------------------
# Start the application
# ----------------------------------------------------------------------------
CMD ["python", "run.py"]
